### 持久化


哪些东西需要持久化？
- node当前的任期。 raft要求只给高于自任期的node 投票，如果当前node 不持久化自身的所处任期，那么就有可能给低任期的节点投票。假设 A 节点在任期 5 时崩溃，重启后它不知道现在是任期 5，会误以为是任期 0。然后有个任期为 1 的候选人来请求投票，A 可能就投了票，此时他的任期会从5变成1， 违反了任期单调递增原则。 
- 投票给了谁voteFor。保证每个任期最多投出一票，若不持久化，节点崩溃后重启就可能再次投票，违反规则。
- 日志。如果不持久化日志复制的效率就太低了。


什么时候持久化？

- follow收到拉票请求后，持久化后再返回响应。 确保votefor 投票给了谁 持久化下来。
- leader 每一次commit 都需要持久化。 确保已提交的日志持久化了。
- follow 每一次收到日志时，都需要持久化后才返回响应。